<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„ì´í† ë¦¬(AITori) ì„±ì¥ ì‹œë®¬ë ˆì´ì…˜ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f3f4f6; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); padding: 1.5rem; }
        .input-slider { -webkit-appearance: none; width: 100%; height: 6px; background: #e5e7eb; border-radius: 5px; outline: none; }
        .input-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 18px; height: 18px; border-radius: 50%; background: #4f46e5; cursor: pointer; transition: background .15s ease-in-out; }
        .input-slider::-webkit-slider-thumb:hover { background: #4338ca; }
    </style>
</head>
<body class="text-gray-800">

    <!-- Top Navigation -->
    <nav class="bg-indigo-900 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold flex items-center gap-2">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                ì•„ì´í† ë¦¬(AITori) ê²½ì˜ ì‹œë®¬ë ˆì´í„°
            </h1>
            <div class="text-sm text-indigo-200">Data Source: 5ê°œë…„ ì„±ì¥ ë¡œë“œë§µ</div>
        </div>
    </nav>

    <div class="container mx-auto p-6 grid grid-cols-12 gap-6">

        <!-- Left Sidebar: Controls -->
        <div class="col-span-12 lg:col-span-3 space-y-6">
            <div class="card border-l-4 border-indigo-500">
                <h2 class="text-lg font-bold mb-4 text-gray-700">âš™ï¸ ì‹œë®¬ë ˆì´ì…˜ ë³€ìˆ˜ ì¡°ì •</h2>
                <p class="text-xs text-gray-500 mb-6">ì•„ë˜ ë³€ìˆ˜ë¥¼ ì¡°ì ˆí•˜ì—¬ "What-if" ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë¶„ì„í•˜ì„¸ìš”.</p>

                <!-- Control 1: User Growth -->
                <div class="mb-6">
                    <label class="flex justify-between text-sm font-medium mb-2">
                        <span>íšŒì› ìœ ì… ê³„ìˆ˜</span>
                        <span id="val-traffic" class="text-indigo-600 font-bold">100%</span>
                    </label>
                    <input type="range" min="50" max="200" value="100" class="input-slider" id="input-traffic">
                    <p class="text-xs text-gray-400 mt-1">ë§ˆì¼€íŒ… íš¨ìœ¨ ë° ì‹œì¥ ë°˜ì‘ë„</p>
                </div>

                <!-- Control 2: Conversion Rate -->
                <div class="mb-6">
                    <label class="flex justify-between text-sm font-medium mb-2">
                        <span>ìœ ë£Œ ì „í™˜ìœ¨ ë³´ì •</span>
                        <span id="val-conv" class="text-indigo-600 font-bold">0%p</span>
                    </label>
                    <input type="range" min="-2.0" max="5.0" step="0.1" value="0" class="input-slider" id="input-conv">
                    <p class="text-xs text-gray-400 mt-1">ê¸°ë³¸ ì „í™˜ìœ¨(5~6.9%)ì— ê°€ê° (+/-)</p>
                </div>

                <!-- Control 3: ARPU -->
                <div class="mb-6">
                    <label class="flex justify-between text-sm font-medium mb-2">
                        <span>ê°€ê²©/ê°ë‹¨ê°€(ARPU)</span>
                        <span id="val-price" class="text-indigo-600 font-bold">100%</span>
                    </label>
                    <input type="range" min="80" max="150" value="100" class="input-slider" id="input-price">
                    <p class="text-xs text-gray-400 mt-1">êµ¬ë…ë£Œ ì¸ìƒ ë˜ëŠ” í”„ë¦¬ë¯¸ì—„ ë¹„ì¤‘</p>
                </div>

                <!-- Control 4: Cost Efficiency -->
                <div class="mb-6">
                    <label class="flex justify-between text-sm font-medium mb-2">
                        <span>ìš´ì˜ ë¹„ìš© íš¨ìœ¨</span>
                        <span id="val-cost" class="text-indigo-600 font-bold">100%</span>
                    </label>
                    <input type="range" min="80" max="150" value="100" class="input-slider" id="input-cost">
                    <p class="text-xs text-gray-400 mt-1">ë‚®ì„ìˆ˜ë¡ ë¹„ìš© ì ˆê° (ì´ìµ ì¦ê°€)</p>
                </div>

                <button onclick="resetSimulation()" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 py-2 rounded-lg text-sm font-bold transition">
                    ì´ˆê¸°í™” (Base Case)
                </button>
            </div>

            <!-- Scenario Info -->
            <div class="card bg-blue-50 border border-blue-100">
                <h3 class="text-sm font-bold text-blue-800 mb-2">â„¹ï¸ í˜„ì¬ ì‹œë‚˜ë¦¬ì˜¤ ìš”ì•½</h3>
                <ul class="text-xs text-blue-700 space-y-2">
                    <li>â€¢ 5ë…„ì°¨ ëª©í‘œ íšŒì›: <span id="scen-users" class="font-bold">400,000</span>ëª…</li>
                    <li>â€¢ 5ë…„ì°¨ ëª©í‘œ ë§¤ì¶œ: <span id="scen-rev" class="font-bold">65.1</span>ì–µì›</li>
                    <li>â€¢ ì†ìµë¶„ê¸°ì (BEP): <span id="scen-bep" class="font-bold">Y3</span> ì˜ˆìƒ</li>
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-span-12 lg:col-span-9 grid grid-cols-12 gap-6">
            
            <!-- KPI Cards -->
            <div class="col-span-12 grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="card border-l-4 border-blue-500 p-4">
                    <p class="text-xs text-gray-500 font-bold uppercase">Y5 ì´ ë§¤ì¶œ</p>
                    <h3 class="text-2xl font-bold text-gray-800 mt-1"><span id="kpi-revenue">0</span> <span class="text-sm text-gray-500">ë°±ë§Œì›</span></h3>
                    <p id="kpi-revenue-growth" class="text-xs text-green-600 mt-1 font-bold">Base ëŒ€ë¹„ ë³€ë™ì—†ìŒ</p>
                </div>
                <div class="col-span-1 md:col-span-1 card border-l-4 border-green-500 p-4">
                    <p class="text-xs text-gray-500 font-bold uppercase">Y5 ì˜ì—…ì´ìµ</p>
                    <h3 class="text-2xl font-bold text-gray-800 mt-1"><span id="kpi-profit">0</span> <span class="text-sm text-gray-500">ë°±ë§Œì›</span></h3>
                    <p id="kpi-margin" class="text-xs text-gray-500 mt-1">ì´ìµë¥ : 0%</p>
                </div>
                <div class="col-span-1 md:col-span-1 card border-l-4 border-purple-500 p-4">
                    <p class="text-xs text-gray-500 font-bold uppercase">Y5 ì´ íšŒì›ìˆ˜</p>
                    <h3 class="text-2xl font-bold text-gray-800 mt-1"><span id="kpi-members">0</span> <span class="text-sm text-gray-500">ëª…</span></h3>
                    <p id="kpi-paid" class="text-xs text-purple-600 mt-1">ìœ ë£Œ: 0ëª…</p>
                </div>
                <div class="col-span-1 md:col-span-1 card border-l-4 border-yellow-500 p-4">
                    <p class="text-xs text-gray-500 font-bold uppercase">5ë…„ ëˆ„ì  ë§¤ì¶œ</p>
                    <h3 class="text-2xl font-bold text-gray-800 mt-1"><span id="kpi-total-rev">0</span> <span class="text-sm text-gray-500">ë°±ë§Œì›</span></h3>
                    <p class="text-xs text-gray-400 mt-1">CAGR(ì—°í‰ê·  ì„±ì¥): <span id="kpi-cagr">0%</span></p>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="col-span-12 md:col-span-7 card">
                <h3 class="text-sm font-bold text-gray-600 mb-4">ğŸ“ˆ ë§¤ì¶œ ë° ì˜ì—…ì´ìµ ì¶”ì´ (Y1~Y5)</h3>
                <canvas id="financialChart" height="220"></canvas>
            </div>
            <div class="col-span-12 md:col-span-5 card">
                <h3 class="text-sm font-bold text-gray-600 mb-4">ğŸ‘¥ íšŒì› ì„±ì¥ ë° ìœ ë£Œ íšŒì›</h3>
                <canvas id="growthChart" height="300"></canvas>
            </div>

            <!-- Detailed Table -->
            <div class="col-span-12 card overflow-hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-gray-700">ğŸ“‹ ì—°ë„ë³„ ì¶”ì • ì†ìµê³„ì‚°ì„œ (P&L Summary)</h3>
                    <span class="text-xs bg-gray-200 px-2 py-1 rounded text-gray-600">ë‹¨ìœ„: ë°±ë§Œì›</span>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full text-sm text-left text-gray-600">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50 border-b">
                            <tr>
                                <th class="px-6 py-3">êµ¬ë¶„</th>
                                <th class="px-6 py-3 text-right">Y1 (MVP)</th>
                                <th class="px-6 py-3 text-right">Y2 (ì„±ì¥)</th>
                                <th class="px-6 py-3 text-right">Y3 (í™•ì¥)</th>
                                <th class="px-6 py-3 text-right">Y4 (ë„ì•½)</th>
                                <th class="px-6 py-3 text-right">Y5 (ì„±ìˆ™)</th>
                            </tr>
                        </thead>
                        <tbody id="table-body" class="divide-y divide-gray-100">
                            <!-- Javascript renders this -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-gray-800 text-gray-400 text-center py-6 mt-10">
        <p class="text-sm">Â© 2025 AITori Growth Simulator. Based on internal estimation data.</p>
    </footer>

    <script>
        // 1. Base Data (From Uploaded CSVs)
        // ë‹¨ìœ„: íšŒì›(ì²œëª…), ë§¤ì¶œ/ì´ìµ(ë°±ë§Œì›)
        const baseData = {
            years: ['Y1', 'Y2', 'Y3', 'Y4', 'Y5'],
            members: [9.5, 50, 120, 250, 400], // ì²œëª…
            conversion: [5.0, 5.0, 5.0, 6.0, 6.9], // %
            revenue: [113, 590, 1416, 3541, 6513], // ë°±ë§Œì›
            profit: [-78, -168, 120, 1156, 3047], // ë°±ë§Œì›
            // ì—­ì‚°ëœ ë¹„ìš© (ë§¤ì¶œ - ì˜ì—…ì´ìµ)
            costs: [191, 758, 1296, 2385, 3466] 
        };

        // State Variables
        let state = {
            trafficMod: 1.0,    // 1.0 = 100%
            conversionAdd: 0.0, // +0.0%p
            priceMod: 1.0,      // 1.0 = 100%
            costMod: 1.0        // 1.0 = 100%
        };

        // Chart Instances
        let financialChart = null;
        let growthChart = null;

        // Initialization
        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            updateSimulation();
            setupListeners();
        });

        function setupListeners() {
            document.getElementById('input-traffic').addEventListener('input', (e) => {
                state.trafficMod = parseInt(e.target.value) / 100;
                document.getElementById('val-traffic').innerText = e.target.value + '%';
                updateSimulation();
            });
            document.getElementById('input-conv').addEventListener('input', (e) => {
                state.conversionAdd = parseFloat(e.target.value);
                const sign = state.conversionAdd >= 0 ? '+' : '';
                document.getElementById('val-conv').innerText = sign + state.conversionAdd + '%p';
                updateSimulation();
            });
            document.getElementById('input-price').addEventListener('input', (e) => {
                state.priceMod = parseInt(e.target.value) / 100;
                document.getElementById('val-price').innerText = e.target.value + '%';
                updateSimulation();
            });
            document.getElementById('input-cost').addEventListener('input', (e) => {
                state.costMod = parseInt(e.target.value) / 100;
                document.getElementById('val-cost').innerText = e.target.value + '%';
                updateSimulation();
            });
        }

        function resetSimulation() {
            document.getElementById('input-traffic').value = 100;
            document.getElementById('input-conv').value = 0;
            document.getElementById('input-price').value = 100;
            document.getElementById('input-cost').value = 100;
            
            // Trigger events to update UI text
            document.getElementById('input-traffic').dispatchEvent(new Event('input'));
            document.getElementById('input-conv').dispatchEvent(new Event('input'));
            document.getElementById('input-price').dispatchEvent(new Event('input'));
            document.getElementById('input-cost').dispatchEvent(new Event('input'));
        }

        function calculateData() {
            let result = {
                members: [],
                paidMembers: [],
                conversion: [],
                revenue: [],
                costs: [],
                profit: [],
                margin: []
            };

            for(let i=0; i<5; i++) {
                // 1. Members Calculation
                let m = baseData.members[i] * state.trafficMod;
                result.members.push(m);

                // 2. Conversion Calculation
                let c = Math.max(0, baseData.conversion[i] + state.conversionAdd); // Can't be negative
                result.conversion.push(c);

                // 3. Paid Members
                let p = m * (c / 100);
                result.paidMembers.push(p);

                // 4. Revenue Calculation
                // Logic: New Revenue = Base Revenue * (New Paid / Base Paid) * Price Mod
                // Base Paid calculation for ratio
                let basePaid = baseData.members[i] * (baseData.conversion[i] / 100);
                let revenueRatio = p / basePaid; 
                
                let r = baseData.revenue[i] * revenueRatio * state.priceMod;
                result.revenue.push(r);

                // 5. Cost & Profit Calculation
                // Costs generally have a fixed component and variable component.
                // For simplicity in this sim: Adjusted Cost = Base Cost * Cost Mod * (Partially variable with Traffic)
                // Let's assume 50% fixed, 50% variable with user scale for better realism
                let memberGrowthRatio = m / baseData.members[i];
                let adjustedCost = baseData.costs[i] * state.costMod * (0.5 + 0.5 * memberGrowthRatio);
                result.costs.push(adjustedCost);

                let profit = r - adjustedCost;
                result.profit.push(profit);
                result.margin.push(r > 0 ? (profit/r * 100) : 0);
            }
            return result;
        }

        function updateSimulation() {
            const data = calculateData();
            
            // Update KPI Cards (Year 5 Data)
            const y5Idx = 4;
            const revY5 = Math.round(data.revenue[y5Idx]);
            const profY5 = Math.round(data.profit[y5Idx]);
            const memY5 = Math.round(data.members[y5Idx] * 1000).toLocaleString();
            const paidY5 = Math.round(data.paidMembers[y5Idx] * 1000).toLocaleString();
            const totalRev = Math.round(data.revenue.reduce((a,b)=>a+b, 0));
            
            // Calculate CAGR (Y1 to Y5 revenue)
            const cagr = Math.pow(data.revenue[4] / data.revenue[0], 1/4) - 1;

            animateValue("kpi-revenue", revY5);
            animateValue("kpi-profit", profY5);
            document.getElementById("kpi-margin").innerText = `ì˜ì—…ì´ìµë¥ : ${data.margin[y5Idx].toFixed(1)}%`;
            document.getElementById("kpi-members").innerText = memY5;
            document.getElementById("kpi-paid").innerText = `ìœ ë£Œ íšŒì›: ${paidY5}ëª…`;
            animateValue("kpi-total-rev", totalRev);
            document.getElementById("kpi-cagr").innerText = (cagr * 100).toFixed(1) + '%';

            // KPI Growth comparison styling
            const revEl = document.getElementById("kpi-revenue-growth");
            const diff = revY5 - baseData.revenue[y5Idx];
            if(diff > 10) { revEl.innerText = `Base ëŒ€ë¹„ +${diff.toLocaleString()}ë°±ë§Œ`; revEl.className = "text-xs text-green-600 mt-1 font-bold"; }
            else if(diff < -10) { revEl.innerText = `Base ëŒ€ë¹„ ${diff.toLocaleString()}ë°±ë§Œ`; revEl.className = "text-xs text-red-600 mt-1 font-bold"; }
            else { revEl.innerText = "Base Caseì™€ ìœ ì‚¬"; revEl.className = "text-xs text-gray-500 mt-1"; }

            // Update Scenario Summary Sidebar
            document.getElementById("scen-users").innerText = (data.members[y5Idx]).toLocaleString();
            document.getElementById("scen-rev").innerText = (revY5 / 100).toFixed(1);
            
            // Find BEP Year
            let bepYear = "ë¯¸ë‹¬ì„±";
            for(let i=0; i<5; i++) {
                if(data.profit[i] > 0) {
                    bepYear = "Y" + (i+1);
                    break;
                }
            }
            document.getElementById("scen-bep").innerText = bepYear;

            // Update Charts
            updateCharts(data);

            // Update Table
            updateTable(data);
        }

        function updateTable(data) {
            const tbody = document.getElementById('table-body');
            const labels = ["ë§¤ì¶œì•¡", "ì˜ì—…ë¹„ìš©", "ì˜ì—…ì´ìµ", "ì´ìµë¥ (%)", "íšŒì›ìˆ˜(ì²œëª…)", "ìœ ë£Œì „í™˜ìœ¨(%)"];
            
            let html = '';
            
            // Row 1: Revenue
            html += `<tr class="bg-white border-b hover:bg-gray-50"><td class="px-6 py-3 font-bold text-gray-900">ë§¤ì¶œì•¡</td>`;
            data.revenue.forEach(v => html += `<td class="px-6 py-3 text-right">${Math.round(v).toLocaleString()}</td>`);
            html += `</tr>`;

            // Row 2: Costs
            html += `<tr class="bg-white border-b hover:bg-gray-50"><td class="px-6 py-3 text-gray-600">ì˜ì—…ë¹„ìš©</td>`;
            data.costs.forEach(v => html += `<td class="px-6 py-3 text-right text-red-400">(${Math.round(v).toLocaleString()})</td>`);
            html += `</tr>`;

            // Row 3: Profit
            html += `<tr class="bg-blue-50 border-b hover:bg-blue-100"><td class="px-6 py-3 font-bold text-blue-900">ì˜ì—…ì´ìµ</td>`;
            data.profit.forEach(v => {
                const color = v >= 0 ? 'text-blue-700' : 'text-red-600';
                html += `<td class="px-6 py-3 text-right font-bold ${color}">${Math.round(v).toLocaleString()}</td>`
            });
            html += `</tr>`;

            // Row 4: Margin
            html += `<tr class="bg-white border-b hover:bg-gray-50"><td class="px-6 py-3 text-xs text-gray-500">ì˜ì—…ì´ìµë¥ </td>`;
            data.margin.forEach(v => html += `<td class="px-6 py-3 text-right text-xs">${v.toFixed(1)}%</td>`);
            html += `</tr>`;

            // Row 5: Members
            html += `<tr class="bg-white border-b hover:bg-gray-50"><td class="px-6 py-3 text-xs text-gray-500">íšŒì›ìˆ˜(ì²œëª…)</td>`;
            data.members.forEach(v => html += `<td class="px-6 py-3 text-right text-xs">${v.toFixed(1)}</td>`);
            html += `</tr>`;

            tbody.innerHTML = html;
        }

        function initCharts() {
            const ctxFin = document.getElementById('financialChart').getContext('2d');
            financialChart = new Chart(ctxFin, {
                type: 'bar',
                data: {
                    labels: baseData.years,
                    datasets: [
                        {
                            label: 'ë§¤ì¶œì•¡',
                            data: [],
                            backgroundColor: 'rgba(79, 70, 229, 0.8)',
                            borderRadius: 4,
                            order: 2
                        },
                        {
                            label: 'ì˜ì—…ì´ìµ',
                            data: [],
                            type: 'line',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 2,
                            tension: 0.3,
                            pointBackgroundColor: 'white',
                            order: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { position: 'bottom' } },
                    scales: { y: { beginAtZero: false, grid: { borderDash: [2, 4] } } }
                }
            });

            const ctxGro = document.getElementById('growthChart').getContext('2d');
            growthChart = new Chart(ctxGro, {
                type: 'line',
                data: {
                    labels: baseData.years,
                    datasets: [
                        {
                            label: 'ì´ íšŒì›ìˆ˜ (ì²œëª…)',
                            data: [],
                            borderColor: 'rgba(99, 102, 241, 1)',
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'ìœ ë£Œ íšŒì›ìˆ˜ (ì²œëª…)',
                            data: [],
                            borderColor: 'rgba(236, 72, 153, 1)',
                            borderDash: [5, 5],
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { position: 'bottom' } },
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        function updateCharts(data) {
            if(!financialChart || !growthChart) return;

            // Financial Chart
            financialChart.data.datasets[0].data = data.revenue;
            financialChart.data.datasets[1].data = data.profit;
            financialChart.update();

            // Growth Chart
            growthChart.data.datasets[0].data = data.members;
            growthChart.data.datasets[1].data = data.paidMembers;
            growthChart.update();
        }

        // Utility for number animation
        function animateValue(id, end) {
            const obj = document.getElementById(id);
            const start = parseInt(obj.innerText.replace(/,/g, '')) || 0;
            if (start === end) return;
            
            const range = end - start;
            const duration = 500;
            let startTime = null;

            function step(timestamp) {
                if (!startTime) startTime = timestamp;
                const progress = Math.min((timestamp - startTime) / duration, 1);
                const value = Math.floor(progress * range + start);
                obj.innerHTML = value.toLocaleString();
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            }
            window.requestAnimationFrame(step);
        }
    </script>
</body>
</html>
